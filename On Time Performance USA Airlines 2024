{"cells":[{"source":"<a href=\"https://www.kaggle.com/code/fiftythirtyfour/usa-airlines-delays-2024?scriptVersionId=240174776\" target=\"_blank\"><img align=\"left\" alt=\"Kaggle\" title=\"Open in Kaggle\" src=\"https://kaggle.com/static/images/open-in-kaggle.svg\"></a>","metadata":{},"cell_type":"markdown"},{"cell_type":"code","execution_count":1,"id":"e3e12fc0","metadata":{"_cell_guid":"b1076dfc-b9ad-4769-8c92-a6c4dae69d19","_uuid":"8f2839f25d086af736a60e9eeb907d3b93b6e0e5","execution":{"iopub.execute_input":"2025-05-17T02:34:00.187418Z","iopub.status.busy":"2025-05-17T02:34:00.187119Z","iopub.status.idle":"2025-05-17T02:34:03.33143Z","shell.execute_reply":"2025-05-17T02:34:03.330541Z"},"papermill":{"duration":3.149473,"end_time":"2025-05-17T02:34:03.332946","exception":false,"start_time":"2025-05-17T02:34:00.183473","status":"completed"},"tags":[]},"outputs":[],"source":["import pandas as pd\n","import numpy as np\n","import seaborn as sns\n","import warnings\n","import glob\n","warnings.filterwarnings('ignore')\n","pd.options.display.max_rows = 1500\n","pd.options.display.max_columns = 500"]},{"cell_type":"code","execution_count":2,"id":"a7346794","metadata":{"execution":{"iopub.execute_input":"2025-05-17T02:34:03.338988Z","iopub.status.busy":"2025-05-17T02:34:03.338606Z","iopub.status.idle":"2025-05-17T02:35:25.599818Z","shell.execute_reply":"2025-05-17T02:35:25.599191Z"},"papermill":{"duration":82.265318,"end_time":"2025-05-17T02:35:25.601227","exception":false,"start_time":"2025-05-17T02:34:03.335909","status":"completed"},"tags":[]},"outputs":[],"source":["csv_files = glob.glob('/kaggle/input/usa-airline-2024/*.csv', recursive=True)\n","df = pd.concat([pd.read_csv(x) for x in csv_files])\n","df = df.drop_duplicates()\n","df.columns = df.columns.str.lower()\n","airline_names = {\n","    \"9E\": \"Endeavor\",\n","    \"AA\": \"American\",\n","    \"AS\": \"Alaska\",\n","    \"B6\": \"JetBlue\",\n","    \"DL\": \"Delta\",\n","    \"F9\": \"Frontier\",\n","    \"G4\": \"Allegiant\",\n","    \"HA\": \"Hawaiian\",\n","    \"MQ\": \"Envoy\",\n","    \"NK\": \"Spirit\",\n","    \"OH\": \"PSA\",\n","    \"OO\": \"SkyWest\",\n","    \"UA\": \"United\",\n","    \"WN\": \"Southwest\",\n","    \"YX\": \"Republic\"\n","}\n","df['airline'] = df['op_unique_carrier'].map(airline_names)\n","df['otp_dep_15'] = np.where(df['dep_del15'] == 1, 0 , 1)\n","df['flight_number'] = df['op_unique_carrier'] + df['op_carrier_fl_num'].fillna('0').astype(int).astype(str).str.zfill(4)\n","df['std_ls_date'] = pd.to_datetime(df['fl_date'])"]},{"cell_type":"code","execution_count":3,"id":"0ae5a8a7","metadata":{"execution":{"iopub.execute_input":"2025-05-17T02:35:25.606486Z","iopub.status.busy":"2025-05-17T02:35:25.606191Z","iopub.status.idle":"2025-05-17T02:35:26.288085Z","shell.execute_reply":"2025-05-17T02:35:26.287209Z"},"papermill":{"duration":0.686033,"end_time":"2025-05-17T02:35:26.289509","exception":false,"start_time":"2025-05-17T02:35:25.603476","status":"completed"},"tags":[]},"outputs":[],"source":["df = df.query('std_ls_date <= \"2024-01-10\"').copy()"]},{"cell_type":"code","execution_count":4,"id":"44955085","metadata":{"execution":{"iopub.execute_input":"2025-05-17T02:35:26.295Z","iopub.status.busy":"2025-05-17T02:35:26.294198Z","iopub.status.idle":"2025-05-17T02:35:26.869616Z","shell.execute_reply":"2025-05-17T02:35:26.868929Z"},"papermill":{"duration":0.579363,"end_time":"2025-05-17T02:35:26.870899","exception":false,"start_time":"2025-05-17T02:35:26.291536","status":"completed"},"tags":[]},"outputs":[],"source":["\n","df['std_ls_time'] = df['crs_dep_time'].replace(2400, 0).astype(str).str.zfill(4)\n","df['std_ls_date_time'] = pd.to_datetime(df['std_ls_date'].dt.strftime('%Y-%m-%d') + ' ' + df['std_ls_time'].str[:2] + ':' + df['std_ls_time'].str[2:])\n","\n","df['atd_ls_time'] = df['dep_time'].fillna(0).replace(2400, 0).astype(int).astype(str).str.zfill(4)\n","\n","df['sta_ls_time'] = df['crs_arr_time'].replace(2400, 0).astype(str).str.zfill(4)\n","df['ata_ls_time'] = df['arr_time'].fillna(0).replace(2400, 0).astype(int).astype(str).str.zfill(4)\n","\n","df['atd_ls_date_time'] = df['std_ls_date_time'] + pd.to_timedelta(df['dep_delay'], unit='m')\n","\n","df['sta_ls_date_time'] = df['std_ls_date_time'] + pd.to_timedelta(df['crs_elapsed_time'], unit='m')\n","df['ata_ls_date_time'] = df['atd_ls_date_time'] + pd.to_timedelta(df['actual_elapsed_time'], unit='m')\n","# df['sta_ls_date_time'] = pd.to_datetime(df['std_ls_date'].dt.strftime('%Y-%m-%d') + ' ' + df['sta_ls_time'].str[:2] + ':' + df['sta_ls_time'].str[2:])\n","# df['ata_ls_date_time'] = pd.to_datetime(df['std_ls_date'].dt.strftime('%Y-%m-%d') + ' ' + df['ata_ls_time'].str[:2] + ':' + df['ata_ls_time'].str[2:])\n","\n"]},{"cell_type":"code","execution_count":5,"id":"8e69920f","metadata":{"execution":{"iopub.execute_input":"2025-05-17T02:35:26.876958Z","iopub.status.busy":"2025-05-17T02:35:26.876667Z","iopub.status.idle":"2025-05-17T02:35:27.411858Z","shell.execute_reply":"2025-05-17T02:35:27.41082Z"},"papermill":{"duration":0.540537,"end_time":"2025-05-17T02:35:27.413515","exception":false,"start_time":"2025-05-17T02:35:26.872978","status":"completed"},"tags":[]},"outputs":[],"source":["num = df.select_dtypes(include='number').columns.to_list()\n","cat = df.select_dtypes(include='object').columns.to_list()\n","\n","target = 'otp_dep_15'\n","num.remove(target)\n","num.remove('dep_del15')\n","\n","from sklearn.model_selection import train_test_split\n","train, test = train_test_split(df, test_size=.2)"]},{"cell_type":"markdown","id":"124e0114","metadata":{"papermill":{"duration":0.001561,"end_time":"2025-05-17T02:35:27.417122","exception":false,"start_time":"2025-05-17T02:35:27.415561","status":"completed"},"tags":[]},"source":["# Data Science"]},{"cell_type":"code","execution_count":6,"id":"a5b76005","metadata":{"execution":{"iopub.execute_input":"2025-05-17T02:35:27.421604Z","iopub.status.busy":"2025-05-17T02:35:27.42135Z","iopub.status.idle":"2025-05-17T02:35:27.454267Z","shell.execute_reply":"2025-05-17T02:35:27.453091Z"},"papermill":{"duration":0.036864,"end_time":"2025-05-17T02:35:27.455677","exception":false,"start_time":"2025-05-17T02:35:27.418813","status":"completed"},"tags":[]},"outputs":[{"data":{"text/html":["<div>\n","<style scoped>\n","    .dataframe tbody tr th:only-of-type {\n","        vertical-align: middle;\n","    }\n","\n","    .dataframe tbody tr th {\n","        vertical-align: top;\n","    }\n","\n","    .dataframe thead th {\n","        text-align: right;\n","    }\n","</style>\n","<table border=\"1\" class=\"dataframe\">\n","  <thead>\n","    <tr style=\"text-align: right;\">\n","      <th></th>\n","      <th>airline</th>\n","      <th>count</th>\n","      <th>mean</th>\n","    </tr>\n","  </thead>\n","  <tbody>\n","    <tr>\n","      <th>0</th>\n","      <td>Southwest</td>\n","      <td>39273</td>\n","      <td>0.740050</td>\n","    </tr>\n","    <tr>\n","      <th>1</th>\n","      <td>American</td>\n","      <td>24853</td>\n","      <td>0.741440</td>\n","    </tr>\n","    <tr>\n","      <th>2</th>\n","      <td>Delta</td>\n","      <td>23144</td>\n","      <td>0.845705</td>\n","    </tr>\n","    <tr>\n","      <th>3</th>\n","      <td>United</td>\n","      <td>19290</td>\n","      <td>0.836288</td>\n","    </tr>\n","    <tr>\n","      <th>4</th>\n","      <td>SkyWest</td>\n","      <td>18056</td>\n","      <td>0.835567</td>\n","    </tr>\n","    <tr>\n","      <th>5</th>\n","      <td>Spirit</td>\n","      <td>7058</td>\n","      <td>0.694106</td>\n","    </tr>\n","    <tr>\n","      <th>6</th>\n","      <td>Envoy</td>\n","      <td>6783</td>\n","      <td>0.783871</td>\n","    </tr>\n","    <tr>\n","      <th>7</th>\n","      <td>JetBlue</td>\n","      <td>6588</td>\n","      <td>0.681087</td>\n","    </tr>\n","    <tr>\n","      <th>8</th>\n","      <td>Republic</td>\n","      <td>6546</td>\n","      <td>0.908952</td>\n","    </tr>\n","    <tr>\n","      <th>9</th>\n","      <td>Alaska</td>\n","      <td>6160</td>\n","      <td>0.771266</td>\n","    </tr>\n","    <tr>\n","      <th>10</th>\n","      <td>PSA</td>\n","      <td>5306</td>\n","      <td>0.815492</td>\n","    </tr>\n","    <tr>\n","      <th>11</th>\n","      <td>Endeavor</td>\n","      <td>5180</td>\n","      <td>0.861583</td>\n","    </tr>\n","    <tr>\n","      <th>12</th>\n","      <td>Frontier</td>\n","      <td>5002</td>\n","      <td>0.750500</td>\n","    </tr>\n","    <tr>\n","      <th>13</th>\n","      <td>Allegiant</td>\n","      <td>3333</td>\n","      <td>0.777078</td>\n","    </tr>\n","    <tr>\n","      <th>14</th>\n","      <td>Hawaiian</td>\n","      <td>2169</td>\n","      <td>0.750115</td>\n","    </tr>\n","  </tbody>\n","</table>\n","</div>"],"text/plain":["      airline  count      mean\n","0   Southwest  39273  0.740050\n","1    American  24853  0.741440\n","2       Delta  23144  0.845705\n","3      United  19290  0.836288\n","4     SkyWest  18056  0.835567\n","5      Spirit   7058  0.694106\n","6       Envoy   6783  0.783871\n","7     JetBlue   6588  0.681087\n","8    Republic   6546  0.908952\n","9      Alaska   6160  0.771266\n","10        PSA   5306  0.815492\n","11   Endeavor   5180  0.861583\n","12   Frontier   5002  0.750500\n","13  Allegiant   3333  0.777078\n","14   Hawaiian   2169  0.750115"]},"execution_count":6,"metadata":{},"output_type":"execute_result"}],"source":["g = df.groupby('airline')[target].agg(['count', 'mean'])\n","g = g.sort_values(by='count', ascending=False)\n","\n","g = g.reset_index()\n","g"]},{"cell_type":"code","execution_count":7,"id":"84f028c2","metadata":{"execution":{"iopub.execute_input":"2025-05-17T02:35:27.460368Z","iopub.status.busy":"2025-05-17T02:35:27.460111Z","iopub.status.idle":"2025-05-17T02:35:27.464908Z","shell.execute_reply":"2025-05-17T02:35:27.464304Z"},"papermill":{"duration":0.008493,"end_time":"2025-05-17T02:35:27.466316","exception":false,"start_time":"2025-05-17T02:35:27.457823","status":"completed"},"tags":[]},"outputs":[{"data":{"text/plain":["['crs_elapsed_time', 'actual_elapsed_time', 'div_actual_elapsed_time']"]},"execution_count":7,"metadata":{},"output_type":"execute_result"}],"source":["[x for x in df.columns if 'elapsed' in x]"]},{"cell_type":"code","execution_count":8,"id":"78193f56","metadata":{"execution":{"iopub.execute_input":"2025-05-17T02:35:27.471743Z","iopub.status.busy":"2025-05-17T02:35:27.471476Z","iopub.status.idle":"2025-05-17T02:35:27.520963Z","shell.execute_reply":"2025-05-17T02:35:27.520389Z"},"papermill":{"duration":0.053237,"end_time":"2025-05-17T02:35:27.521998","exception":false,"start_time":"2025-05-17T02:35:27.468761","status":"completed"},"tags":[]},"outputs":[{"data":{"text/html":["<div>\n","<style scoped>\n","    .dataframe tbody tr th:only-of-type {\n","        vertical-align: middle;\n","    }\n","\n","    .dataframe tbody tr th {\n","        vertical-align: top;\n","    }\n","\n","    .dataframe thead th {\n","        text-align: right;\n","    }\n","</style>\n","<table border=\"1\" class=\"dataframe\">\n","  <thead>\n","    <tr style=\"text-align: right;\">\n","      <th></th>\n","      <th>std_ls_date</th>\n","      <th>flight_number</th>\n","      <th>tail_num</th>\n","      <th>std_ls_date_time</th>\n","      <th>sta_ls_date_time</th>\n","      <th>sta_ls_time</th>\n","      <th>ata_ls_time</th>\n","      <th>dep_delay</th>\n","      <th>crs_elapsed_time</th>\n","    </tr>\n","  </thead>\n","  <tbody>\n","    <tr>\n","      <th>12651</th>\n","      <td>2024-01-01</td>\n","      <td>WN2185</td>\n","      <td>N204WN</td>\n","      <td>2024-01-01 05:00:00</td>\n","      <td>2024-01-01 09:05:00</td>\n","      <td>0805</td>\n","      <td>0753</td>\n","      <td>0.0</td>\n","      <td>245.0</td>\n","    </tr>\n","    <tr>\n","      <th>16177</th>\n","      <td>2024-01-01</td>\n","      <td>WN1855</td>\n","      <td>N8868L</td>\n","      <td>2024-01-01 05:00:00</td>\n","      <td>2024-01-01 09:10:00</td>\n","      <td>0810</td>\n","      <td>0733</td>\n","      <td>1.0</td>\n","      <td>250.0</td>\n","    </tr>\n","    <tr>\n","      <th>16689</th>\n","      <td>2024-01-01</td>\n","      <td>WN1420</td>\n","      <td>N960WN</td>\n","      <td>2024-01-01 05:00:00</td>\n","      <td>2024-01-01 09:30:00</td>\n","      <td>0730</td>\n","      <td>0719</td>\n","      <td>0.0</td>\n","      <td>270.0</td>\n","    </tr>\n","    <tr>\n","      <th>14934</th>\n","      <td>2024-01-01</td>\n","      <td>WN1155</td>\n","      <td>N8612K</td>\n","      <td>2024-01-01 05:00:00</td>\n","      <td>2024-01-01 07:35:00</td>\n","      <td>0935</td>\n","      <td>0920</td>\n","      <td>-3.0</td>\n","      <td>155.0</td>\n","    </tr>\n","    <tr>\n","      <th>15025</th>\n","      <td>2024-01-01</td>\n","      <td>WN0276</td>\n","      <td>N8631A</td>\n","      <td>2024-01-01 05:05:00</td>\n","      <td>2024-01-01 08:00:00</td>\n","      <td>1000</td>\n","      <td>0944</td>\n","      <td>-3.0</td>\n","      <td>175.0</td>\n","    </tr>\n","    <tr>\n","      <th>...</th>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","    </tr>\n","    <tr>\n","      <th>15887</th>\n","      <td>2024-01-01</td>\n","      <td>WN0724</td>\n","      <td>N8813Q</td>\n","      <td>2024-01-01 22:10:00</td>\n","      <td>2024-01-02 00:35:00</td>\n","      <td>2335</td>\n","      <td>2312</td>\n","      <td>-7.0</td>\n","      <td>145.0</td>\n","    </tr>\n","    <tr>\n","      <th>13169</th>\n","      <td>2024-01-01</td>\n","      <td>WN3025</td>\n","      <td>N298WN</td>\n","      <td>2024-01-01 22:10:00</td>\n","      <td>2024-01-01 23:55:00</td>\n","      <td>2355</td>\n","      <td>0036</td>\n","      <td>56.0</td>\n","      <td>105.0</td>\n","    </tr>\n","    <tr>\n","      <th>13971</th>\n","      <td>2024-01-01</td>\n","      <td>WN3064</td>\n","      <td>N7820L</td>\n","      <td>2024-01-01 22:10:00</td>\n","      <td>2024-01-01 23:25:00</td>\n","      <td>0025</td>\n","      <td>0002</td>\n","      <td>-8.0</td>\n","      <td>75.0</td>\n","    </tr>\n","    <tr>\n","      <th>15726</th>\n","      <td>2024-01-01</td>\n","      <td>WN0651</td>\n","      <td>N8781Q</td>\n","      <td>2024-01-01 22:25:00</td>\n","      <td>2024-01-01 23:30:00</td>\n","      <td>2230</td>\n","      <td>2220</td>\n","      <td>-2.0</td>\n","      <td>65.0</td>\n","    </tr>\n","    <tr>\n","      <th>14034</th>\n","      <td>2024-01-01</td>\n","      <td>WN3693</td>\n","      <td>N7833A</td>\n","      <td>2024-01-01 22:55:00</td>\n","      <td>2024-01-02 01:20:00</td>\n","      <td>0120</td>\n","      <td>0108</td>\n","      <td>-7.0</td>\n","      <td>145.0</td>\n","    </tr>\n","  </tbody>\n","</table>\n","<p>4174 rows Ã— 9 columns</p>\n","</div>"],"text/plain":["      std_ls_date flight_number tail_num    std_ls_date_time  \\\n","12651  2024-01-01        WN2185   N204WN 2024-01-01 05:00:00   \n","16177  2024-01-01        WN1855   N8868L 2024-01-01 05:00:00   \n","16689  2024-01-01        WN1420   N960WN 2024-01-01 05:00:00   \n","14934  2024-01-01        WN1155   N8612K 2024-01-01 05:00:00   \n","15025  2024-01-01        WN0276   N8631A 2024-01-01 05:05:00   \n","...           ...           ...      ...                 ...   \n","15887  2024-01-01        WN0724   N8813Q 2024-01-01 22:10:00   \n","13169  2024-01-01        WN3025   N298WN 2024-01-01 22:10:00   \n","13971  2024-01-01        WN3064   N7820L 2024-01-01 22:10:00   \n","15726  2024-01-01        WN0651   N8781Q 2024-01-01 22:25:00   \n","14034  2024-01-01        WN3693   N7833A 2024-01-01 22:55:00   \n","\n","         sta_ls_date_time sta_ls_time ata_ls_time  dep_delay  crs_elapsed_time  \n","12651 2024-01-01 09:05:00        0805        0753        0.0             245.0  \n","16177 2024-01-01 09:10:00        0810        0733        1.0             250.0  \n","16689 2024-01-01 09:30:00        0730        0719        0.0             270.0  \n","14934 2024-01-01 07:35:00        0935        0920       -3.0             155.0  \n","15025 2024-01-01 08:00:00        1000        0944       -3.0             175.0  \n","...                   ...         ...         ...        ...               ...  \n","15887 2024-01-02 00:35:00        2335        2312       -7.0             145.0  \n","13169 2024-01-01 23:55:00        2355        0036       56.0             105.0  \n","13971 2024-01-01 23:25:00        0025        0002       -8.0              75.0  \n","15726 2024-01-01 23:30:00        2230        2220       -2.0              65.0  \n","14034 2024-01-02 01:20:00        0120        0108       -7.0             145.0  \n","\n","[4174 rows x 9 columns]"]},"execution_count":8,"metadata":{},"output_type":"execute_result"}],"source":["g = df.query('\"2024-01-01\" <= std_ls_date <= \"2024-01-01\"')\n","g = g.query('airline == \"Southwest\"')\n","# g = g.query('tail_num == \"N8579Z\"')\n","col = ['std_ls_date', 'flight_number', 'tail_num'\n","       , 'std_ls_date_time'\n","       , 'sta_ls_date_time'\n","       , 'sta_ls_time'\n","       # , 'atd_ls_date_time'\n","       # , 'atd_ls_time'\n","       , 'ata_ls_time'\n","       \n","       # , 'sta_ls_date_time'\n","       # , 'ata_ls_date_time'\n","       # , 'origin', 'dest'\n","\n","       , 'dep_delay'\n","       , 'crs_elapsed_time'\n","      ]\n","g[col].sort_values(by='std_ls_date_time')\n"]},{"cell_type":"code","execution_count":null,"id":"adcfba62","metadata":{"papermill":{"duration":0.00182,"end_time":"2025-05-17T02:35:27.526153","exception":false,"start_time":"2025-05-17T02:35:27.524333","status":"completed"},"tags":[]},"outputs":[],"source":[]}],"metadata":{"kaggle":{"accelerator":"none","dataSources":[{"datasetId":7402244,"sourceId":11829233,"sourceType":"datasetVersion"}],"dockerImageVersionId":31040,"isGpuEnabled":false,"isInternetEnabled":true,"language":"python","sourceType":"notebook"},"kernelspec":{"display_name":"Python 3","language":"python","name":"python3"},"language_info":{"codemirror_mode":{"name":"ipython","version":3},"file_extension":".py","mimetype":"text/x-python","name":"python","nbconvert_exporter":"python","pygments_lexer":"ipython3","version":"3.11.11"},"papermill":{"default_parameters":{},"duration":92.848165,"end_time":"2025-05-17T02:35:28.246579","environment_variables":{},"exception":null,"input_path":"__notebook__.ipynb","output_path":"__notebook__.ipynb","parameters":{},"start_time":"2025-05-17T02:33:55.398414","version":"2.6.0"}},"nbformat":4,"nbformat_minor":5}